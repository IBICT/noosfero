<%= labelled_form_for(:environment, :url => {:action => 'manage_community_fields'}) do |f| %>

<table id='community_fields_conf'>
  <tr>
    <th><%= _('Field') %></th>
    <th><%= _('Active') %></th>
    <th><%= _('Required') %></th>
    <th><%= _('Display on creation?') %></th>
  </tr>

  <tr class='manage-fields-batch-actions'>
    <td>
      <%= _("Check/Uncheck All")%>
    </td>
    <td align="center">
      <input type="checkbox" id="community_active" />
    </td>
    <td align="center">
      <input type="checkbox" id="community_required" />
    </td>
    <td align="center">
      <input type="checkbox" id="community_signup" />
    </td>
    <td>&nbsp;</td>
  </tr>

  <% @community_fields.each do |field| %>
  <tr>
    <td><label for="community_fields[<%= field %>][active]"><%= _(field.humanize) %></label></td>
    <td align="center">
      <%= hidden_field_tag  "community_fields[#{field}][active]", false %>
      <%= check_box_tag "community_fields[#{field}][active]", true, environment.custom_community_field(field, 'active'), :onclick => "active_action(this, 'community_fields[#{field}][required]', 'community_fields[#{field}][signup]')" %>
    </td>
    <td align="center">
      <%= hidden_field_tag  "community_fields[#{field}][required]", false %>
      <%= check_box_tag "community_fields[#{field}][required]", true, environment.custom_community_field(field, 'required'), :onclick => "required_action('community_fields[#{field}][active]','community_fields[#{field}][required]', 'community_fields[#{field}][signup]')" %>
    </td>
    <td align="center">
      <%= hidden_field_tag  "community_fields[#{field}][signup]", false %>
      <%= check_box_tag "community_fields[#{field}][signup]", true, environment.custom_community_field(field, 'signup'), :onclick => "signup_action('community_fields[#{field}][active]','community_fields[#{field}][required]', 'community_fields[#{field}][signup]')" %>
    </td>
  </tr>
  <% end %>

  <% @custom_community_fields.each do |field| %>
  <tr>
    <td>
      <%= text_field_tag "community_fields[#{field}][name]", environment.custom_community_field_name(field) %>
    </td>
    <td align="center">
      <%= hidden_field_tag  "community_fields[#{field}][active]", false %>
      <%= check_box_tag "community_fields[#{field}][active]", true, environment.custom_community_field(field, 'active'), :onclick => "active_action(this, 'community_fields[#{field}][required]', 'community_fields[#{field}][signup]')" %>
    </td>
    <td align="center">
      <%= hidden_field_tag  "community_fields[#{field}][required]", false %>
      <%= check_box_tag "community_fields[#{field}][required]", true, environment.custom_community_field(field, 'required'), :onclick => "required_action('community_fields[#{field}][active]','community_fields[#{field}][required]', 'community_fields[#{field}][signup]')" %>
    </td>
    <td align="center">
      <%= hidden_field_tag  "community_fields[#{field}][signup]", false %>
      <%= check_box_tag "community_fields[#{field}][signup]", true, environment.custom_community_field(field, 'signup'), :onclick => "required_action('community_fields[#{field}][active]','community_fields[#{field}][required]', 'community_fields[#{field}][signup]')" %>
    </td>
    <td>
      <a href="#" class="button icon-delete delete-link-list-row" title="Delete" onclick="return remove_custom_field(this);"><span>Delete</span></a>
    </td>
  </tr>
  <% end %>

</table>

<br />

<%= link_to_function(_('Add field'), "add_new_field('community');", :class => 'button icon-add with-text') %>

<script type='text/javascript'>
  //var trs = jQuery('#community_fields_conf tr');
  //var tr, td2;
  //for ( var i=2; tr=trs[i]; i++ ) {
  //  if ( td2 = tr.getElementsByTagName('td')[1] ) {
  //    td2.getElementsByTagName('input')[1].onclick();
  //  }
  //}
</script>

<div>
  <% button_bar do %>
    <%= submit_button('save', _('Save changes'), :id=>"save_community_fields") %>
    <%= button :back, _('Back to admin panel'), :controller => 'admin_panel', :action => 'index' %>
  <% end %>
</div>

<% end %>




