<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="<%= html_language %>" lang="<%= html_language %>" class="<%= h html_tag_classes %>">
  <head>
    <title><%= h page_title %></title>
    <%= yield(:feeds) %>
    <!--<meta http-equiv="refresh" content="1"/>-->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="description" content="<%= @environment.name %>" />

    <!-- site root -->
    <meta property="noosfero:root" content="<%= Noosfero.root %>"/>

    <link rel="shortcut icon" href="<%= image_path(theme_favicon) %>" type="image/x-icon" />
    <%= noosfero_javascript %>
    <%= noosfero_stylesheets %>

    <%# Add custom tags/styles/etc via content_for %>
    <%= yield :head %>
    <%=
      @plugins.dispatch(:head_ending).map do |content|
        if content.respond_to?(:call) then instance_exec(&content).to_s.html_safe else content.to_s.html_safe end
      end.join("\n")
    %>

    <script type='text/javascript'>
      DEFAULT_LOADING_MESSAGE = <%="'#{ _('loading...') }'" %>;
    </script>

  </head>
  <body class="<%= h body_classes %>">
    <a href="#content" id="link-go-content"><span><%= _("Go to the content") %></span></a>

    <%=
      @plugins.dispatch(:body_beginning).map do |content|
        if content.respond_to?(:call) then instance_exec(&content).to_s.html_safe else content.to_s.html_safe end
      end.join("\n")
    %>

    <div id="wrap-1">
      <div id='theme-header'>
        <%= theme_header %>
      </div>
      <div id="wrap-2">
        <%= render :partial => 'layouts/user' %>
        <h1 id="site-title">
          <%= theme_site_title %>
        </h1>
        <div id="navigation">
          <ul>
            <%= theme_extra_navigation %>
          </ul>
          <div id="navigation-end"></div>
        </div><!-- end id="navigation" -->
        <div id="content">
          <%= render 'layouts/content' %>
        </div><!-- end id="content" -->
      </div><!-- end id="wrap-2" -->
    </div><!-- end id="wrap-1" -->
    <%= render_environment_features(:logged_in) if logged_in? %>
    <div id="theme-footer">
      <%= theme_footer %>
    </div><!-- end id="theme-footer" -->
    <%= noosfero_layout_features %>
    <%= addthis_javascript %>
    <%=
      @plugins.dispatch(:body_ending).map do |content|
        if content.respond_to?(:call) then instance_exec(&content).html_safe else content.html_safe end
      end.join("\n")
    %>

    <!-- Piwik -->
    <script type="text/javascript">
      var _paq = _paq || [];
      _paq.push(["trackPageView"]);
      _paq.push(["enableLinkTracking"]);

      (function() {
        var u="http://estatisticas.presidencia.gov.br/";
        _paq.push(["setTrackerUrl", u+"piwik.php"]);
        _paq.push(["setSiteId", "14"]);
        var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0]; g.type="text/javascript";
        g.defer=true; g.async=true; g.src="/javascripts/piwik.js"; s.parentNode.insertBefore(g,s);
      })();
    </script>
    <!-- End Piwik Code -->

    <!-- Feedback -->
    <link href='//feedback.participa.br/assets/feedback.css' media='all' rel='stylesheet'>
    <script src='//feedback.participa.br/assets/feedback_client.js'></script>
    
    <script type=text/javascript>
        $(document).ready(function() {
          Feedback(
                  {
                      label: "Dê um Feedback!",
                      header: "Registro de ocorrência",
                      url: "//feedback.participa.br/api/v1/feedbacks?access_token=pINDdceSPik_4vRCleHTQg",
                      nextLabel: "Continuar",
                      reviewLabel: "Revisar",
                      sendLabel:  "Enviar",
                      closeLabel: "Fechar",
                      highlightBlackoutHelp: "Você pode destacar informações úteis ou ocultar informações sensíveis.",
                      blackoutButtonLabel: "Ocultar",
                      highlightButtonLabel: "Destacar",
                      messageSuccess: "O seu feedback foi enviado com sucesso!",
                      messageError: "Houve um erro ao enviar o feedback...",
                      pages: [
                              new window.Feedback.Form([
                                      {
                                          type: "select",
                                          name: "tipo_relato",
                                          label: "Tipo de Relato",
                                          options: ["Sugestão", "Erro", "Elogio"],
                                          required: true
                                      },
                                      {
                                          type: "starrating",
                                          name: "starrating",
                                          label: "Avalie",
                                          options: ["1", "2", "3", "4", "5"]
                                      },
                                     {
                                          type: "textarea",
                                          name: "observacao",
                                          label: "Observação"
                                      },
                                      {
                                          type: "hidden",
                                          name: "situacao",
                                          value: "aberto",
                                          review: false
                                      }
                                      ]
                              ),
                              new window.Feedback.Screenshot(),
                              new window.Feedback.Review()
                      ]
                   });
        });
    
    </script>
    <!-- End Feedback Code -->
  </body>
</html>
